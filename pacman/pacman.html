<!DOCTYPE html>
<html>
<head>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
<div>
<image id="pacManImg" src="https://trendsupdates.com/wp-content/uploads/2011/04/pacman.jpg" style="display: none;" ></image>
<image id="altPacManImg" src="http://cdn.pcwallart.com/images/pacman-logo-wallpaper-1.jpg" style="display: none;"></image>
<image id="ghostsImg" src="https://userscontent2.emaze.com/images/a6ffb80f-abff-4693-8665-1021f4db6835/b23c4ab8-5e03-44e9-b95e-7b315690f466.jpg" style="display: none;" ></image>
<canvas id="myCanvas" width="200" height="100" style="border:0px solid #000000;"></canvas> <br>
</div>
<script>
 function PacmanGame() {
 

   // params
   var speed=0.5;
   var scale=1.5;
 
   // code start params

   function genBoard() {
     var halfBoard=[ // left side of  the board (it is symmetric)
               "xxxxxxxxxxxxxx",
               "x............x",
               "x.xxxx.xxxxx.x",
               "x*x  x.x   x.x",
               "x.xxxx.xxxxx.x",
               "x.............",
               "x.xxxx.xx.xxxx",
               "x.xxxx.xx.xxxx",
               "x......xx....x",
               "xxxxxx.xxxxx.x",
               "     x.xxxxx.x",
               "     x.xx.....",
               "     x.xx.xxxx",
               "xxxxxx.xx.x   ",
               "..........x   ",
               "xxxxxx.xx.x   ",
               "     x.xx.xxxx",
               "     x.xx.....",
               "     x.xx.xxxx",
               "xxxxxx.xx.xxxx",
               "x............x",
               "x.xxxx.xxxxx.x",
               "x.xxxx.xxxxx.x",
               "x*..xx........",
               "xxx.xx.xx.xxxx",
               "xxx.xx.xx.xxxx",
               "x......xx....x",
               "x.xxxxxxxxxx.x",
               "x.xxxxxxxxxx.x",
               "x.............",
               "xxxxxxxxxxxxxx"];
     // build full board
     var board=halfBoard;
     var width=halfBoard[0].length;
     for (var y=0;y<halfBoard.length;y++)
     {
       for (var x=0;x<width;x++)
         board[y]+=halfBoard[y][width-x-1];
     }
     return board;
   }
   
   var board=genBoard();

   var boardWidth=board[0].length;
   var boardHeight=board.length;
   
   var pixWidth=window.screen.availWidth/boardWidth/2*scale;
   var pixHeight=window.screen.availHeight/boardHeight/2*scale;
   
   // limit aspect to 1.3:
   var aspect=pixWidth/pixHeight;
   var maxAspect=1.3;
   if (aspect>maxAspect)
     pixWidth=maxAspect*pixHeight;
   else if (aspect<1/maxAspect)
     pixHeight=pixWidth/maxAspect;
   

   $("canvas").attr("width",boardWidth*pixWidth);
   $("canvas").attr("height",boardHeight*pixHeight);
   

   var canvas = document.getElementById("myCanvas");
   var ctx = canvas.getContext("2d");
   
   function drawBoard()
   {
     ctx.fillStyle = 'black';
     ctx.fillRect(0,0,boardWidth*pixWidth,boardHeight*pixHeight); 
     for(var y=0;y<boardHeight;y++)
     {
       for (var x=0;x<boardWidth;x++)
       {
         if (board[y][x]=='x') // is walls
         {
           ctx.fillStyle = 'blue';
           if ( // top left
               x<boardWidth-1 &&
               y<boardHeight-1 &&
               board[y][x+1]=='x' &&
               board[y+1][x]=='x' &&
               board[y+1][x+1]!='x' &&
               (y==0 || board[y-1][x]!='x') &&
               (x==0 || board[y][x-1]!='x')
               )
           {
             ctx.save();
             ctx.scale(1,pixHeight/pixWidth);
             //ctx.scale(pixWidth/pixHeight,1);
             ctx.beginPath();
             var r=pixWidth/2;
             ctx.arc((x+1)*pixWidth,(y+1)*pixWidth,r, 1 * Math.PI, 1.5 * Math.PI, false);
             ctx.fill();
             ctx.lineWidth = pixWidth;
             //ctx.strokeStyle = '#003300';
             ctx.strokeStyle = ctx.fillStyle;
             ctx.stroke();  
             ctx.restore();
           } else {
             ctx.fillRect(x*pixWidth,y*pixHeight,pixWidth,pixHeight); 
           }
         } // dot or power dot
         else if (board[y][x]=='.' || board[y][x]=='*')
         {
           var r=pixWidth/20+1;         
           ctx.fillStyle = 'pink';
           if (board[y][x]=='*')
           {
             ctx.fillStyle = 'pink';
             r*=2;
           }             
           ctx.beginPath();
           ctx.arc((0.5+x)*pixWidth,(0.5+y)*pixHeight,r, 0, 2 * Math.PI, false);
           ctx.fill();
           //ctx.lineWidth = 5;
           //ctx.strokeStyle = '#003300';
           ctx.strokeStyle = ctx.fillStyle;
           ctx.stroke();
         }
       }
     }
   }
   
   function Character(_charType)
   {
     var charType=_charType; // 0 - pacman, 1-4 : ghosts
     var that=this;
      
     var imageDetails=
       [
         //{ Id:"pacManImg",sx:50,sy:100,sw:500,sh:600 ,startX:1,startY:1},
         { Id:"pacManImg",startX:1,startY:1},
         { Id:"ghostsImg",sx:10,sy:60,sw:200,sh:200  ,startX:12,startY:13}, // 860x484
         { Id:"ghostsImg",sx:220,sy:60,sw:200,sh:200 ,startX:15,startY:13},
         { Id:"ghostsImg",sx:440,sy:60,sw:200,sh:200 ,startX:12,startY:15},
         { Id:"ghostsImg",sx:660,sy:60,sw:200,sh:200 ,startX:15,startY:15}
       ];
     var posX=imageDetails[charType].startX; // start pos
     var posY=imageDetails[charType].startY;
     this.draw=function()
     {
       var img=document.getElementById( imageDetails[charType].Id);
       var sx=imageDetails[charType].sx;
       if (typeof sx==='undefined')
       {
         ctx.drawImage(img,posX*pixWidth,posY*pixHeight,pixWidth,pixHeight);
       } else {
         var sy=imageDetails[charType].sy;
         var sw=imageDetails[charType].sw;
         var sh=imageDetails[charType].sh;
         ctx.drawImage(img,sx,sy,sw,sh,posX*pixWidth,posY*pixHeight,pixWidth,pixHeight);
       }
     }
     function erase()
     {
        ctx.fillStyle="black";
        ctx.fillRect(posX*pixWidth,posY*pixHeight,pixWidth,pixHeight);   
     }
  
     var moveVer=0;
     this.move=function(dx,dy,lastMoveVer)
     {
       if (typeof  lastMoveVer!=='undefined')
       {
          if (moveVer!=lastMoveVer)
            return;
       }
       newX=posX+dx;
       newY=posY+dy;
       if (newX<0)
         newX=boardWidth-1;
       else if (newX>=boardWidth)
         newX=0;
       if (newY<0)
         newY=boardHeight-1
       else if (newY>=boardHeight)
         newY=0;
       if (board[newY][newX]=='x')
         return;
       erase();
       posX=newX;
       posY=newY;
       that.draw();
       if (typeof  lastMoveVer==='undefined')
       {
         moveVer++;
       }
       var saveMoveVer=moveVer;
       setTimeout(function() { that.move(dx,dy,saveMoveVer);} , 100/speed);
     }
   };

   var pacman=new Character(0);
   
   drawBoard();
   pacman.draw();
   ghosts=[0,0,0,0];
   for (var i=0;i<4;i++)
   {
    ghosts[i]=new Character(i+1);
    ghosts[i].draw();
   }

   document.onkeypress=function(e){
     var e=window.event || e;
     if (e.key==="ArrowRight")
       pacman.move(1,0);
     else if (e.key==="ArrowLeft")
       pacman.move(-1,0);
     else if (e.key==="ArrowDown")
       pacman.move(0,1);
     else if (e.key==="ArrowUp")
       pacman.move(0,-1);
  };

   pacman.move(1,0); // start moving right
 };
 var g=new PacmanGame();
 // vim: set sw=2 ts=2 et
</script>
</body>
</html>


